<html>
<head>
  <title>Noisy Sphere | seen.js</title>
  
  <link href="http://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css"/>
  
  <link href="css/theme.css" rel="stylesheet" type="text/css"/>
  
  
  <script src="lib/seen.min.js"></script>
  
  <script src="http://cdnjs.cloudflare.com/ajax/libs/coffee-script/1.7.1/coffee-script.min.js"></script>
  
</head>
<body>
  <div class="page">
    <h1>Noisy Sphere</h1>
    <div></div>

        <div class="nav-bar">
      <div class="nav-button-wrapper" style="text-align : left;">
        
          <a href="demo-noisy-patch.html"><div class="nav-button">
          <div class="label">prev</div><div class="title">Noisy Wave Patch</div>
          </div></a>
        
      </div>
      <div class="nav-button-wrapper" style="text-align : center;">
          <a href="index.html"><div class="nav-button">
          <div class="label">up</div><div class="title">to index</div>
          </div></a>
      </div>
      <div class="nav-button-wrapper" style="text-align : right;">
        
          <a href="demo-svg-canvas.html"><div class="nav-button">
          <div class="label">next</div><div class="title">Same Scene, Canvas vs. SVG</div>
          </div></a>
        
      </div>
    </div>

    
    <canvas width="900" height="500" id="seen-canvas"></canvas>
    

    
    

    
<script type="text/coffeescript" src="lib/simplex-noise.coffee"></script>
<script type="text/coffeescript" id="code">
  width  = 900
  height = 500

  # Create a simple sphere
  shape = seen.Shapes.sphere(2).scale(150)
  seen.Colors.randomSurfaces2(shape)

  # Create scene and render context
  scene = new seen.Scene
    fractionalPoints : true  # Smoothes motion
    cullBackfaces    : false # Necessary since we have transparency
    model            : seen.Models.default().add(shape)
    camera           : new seen.Camera
      viewport : seen.Viewports.center(width, height)

  context = seen.Context('seen-canvas', scene).render()

  # Create a copy of the surface points so we can manipulate them later
  for surf in shape.surfaces
    surf.originals = surf.points.map (p) -> p.copy()
    surf.fill.color.a = 150 # Add a little transparency
  
  # Apply animated 3D simplex noise to sphere vertices
  t = 0
  noiser = new Simplex3D(Math.random())
  context.animate()
    .onBefore(->
      for surf in shape.surfaces
        for p,i in surf.points
          n = noiser.noise(p.x, p.y, p.z + t)
          surf.points[i] = surf.originals[i].copy().multiply(1 + n / 3)

        # Since we're modifying the points directly, we need to mark the surface dirty
        # to make sure the cache doesn't ignore the change
        surf.dirty = true

      shape.rotx(0.001).rotz(0.003)
      t += 0.005
    )
    .start()

  # Enable drag-to-rotate
  dragger = new seen.Drag(document.getElementById('seen-canvas'), {inertia : true})
  dragger.on('drag.rotate', (e) ->
    xform = seen.Quaternion.xyToTransform(e.offsetRelative...)
    shape.transform(xform)
    context.render()
  )
</script>


    
    <link href="http://yandex.st/highlightjs/8.0/styles/monokai_sublime.min.css" rel="stylesheet" type="text/css"/>
<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>
<pre id="code-view"></pre>
<script type="text/javascript">
  var view = document.getElementById('code-view');
  var code = document.getElementById('code');
  view.innerHTML = code.innerHTML;
  hljs.highlightBlock(view);
</script>
    
  </div>
</body>
</html>
